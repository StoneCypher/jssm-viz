"use strict";function unwrapExports(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}function createCommonjsModule(fn,module){return fn(module={exports:{}},module.exports),module.exports}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},WorkerWrapper=function(){function WorkerWrapper(worker){var _this=this;classCallCheck(this,WorkerWrapper),this.worker=worker,this.listeners=[],this.nextId=0,this.worker.addEventListener("message",function(event){var id=event.data.id,error=event.data.error,result=event.data.result;_this.listeners[id](error,result),delete _this.listeners[id]})}return createClass(WorkerWrapper,[{key:"render",value:function(src,options){var _this2=this;return new Promise(function(resolve,reject){var id=_this2.nextId++;_this2.listeners[id]=function(error,result){error?reject(new Error(error.message,error.fileName,error.lineNumber)):resolve(result)},_this2.worker.postMessage({id:id,src:src,options:options})})}}]),WorkerWrapper}(),ModuleWrapper=function ModuleWrapper(module,render){classCallCheck(this,ModuleWrapper);var instance=module();this.render=function(src,options){return new Promise(function(resolve,reject){try{resolve(render(instance,src,options))}catch(error){reject(error)}})}};function b64EncodeUnicode(str){return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,function(match,p1){return String.fromCharCode("0x"+p1)}))}function defaultScale(){return"devicePixelRatio"in window&&1<window.devicePixelRatio?window.devicePixelRatio:1}function svgXmlToImageElement(svgXml){var _ref=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},_ref$scale=_ref.scale,scale=void 0===_ref$scale?defaultScale():_ref$scale,_ref$mimeType=_ref.mimeType,mimeType=void 0===_ref$mimeType?"image/png":_ref$mimeType,_ref$quality=_ref.quality,quality=void 0===_ref$quality?1:_ref$quality;return new Promise(function(resolve,reject){var svgImage=new Image;svgImage.onload=function(){var canvas=document.createElement("canvas");canvas.width=svgImage.width*scale,canvas.height=svgImage.height*scale,canvas.getContext("2d").drawImage(svgImage,0,0,canvas.width,canvas.height),canvas.toBlob(function(blob){var image=new Image;image.src=URL.createObjectURL(blob),image.width=svgImage.width,image.height=svgImage.height,resolve(image)},mimeType,quality)},svgImage.onerror=function(e){var error;error="error"in e?e.error:new Error("Error loading SVG"),reject(error)},svgImage.src="data:image/svg+xml;base64,"+b64EncodeUnicode(svgXml)})}function svgXmlToImageElementFabric(svgXml){var _ref2=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},_ref2$scale=_ref2.scale,scale=void 0===_ref2$scale?defaultScale():_ref2$scale,_ref2$mimeType=_ref2.mimeType,mimeType=void 0===_ref2$mimeType?"image/png":_ref2$mimeType,_ref2$quality=_ref2.quality,quality=void 0===_ref2$quality?1:_ref2$quality,multiplier=scale,format=void 0;return"image/jpeg"==mimeType?format="jpeg":"image/png"==mimeType&&(format="png"),new Promise(function(resolve,reject){fabric.loadSVGFromString(svgXml,function(objects,options){0==objects.length&&reject(new Error("Error loading SVG with Fabric"));var element=document.createElement("canvas");element.width=options.width,element.height=options.height;var canvas=new fabric.Canvas(element,{enableRetinaScaling:!1}),obj=fabric.util.groupSVGElements(objects,options);canvas.add(obj).renderAll();var image=new Image;image.src=canvas.toDataURL({format:format,multiplier:multiplier,quality:quality}),image.width=options.width,image.height=options.height,resolve(image)})})}var Viz=function(){function Viz(){var _ref3=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},workerURL=_ref3.workerURL,worker=_ref3.worker,Module=_ref3.Module,render=_ref3.render;if(classCallCheck(this,Viz),void 0!==workerURL)this.wrapper=new WorkerWrapper(new Worker(workerURL));else if(void 0!==worker)this.wrapper=new WorkerWrapper(worker);else if(void 0!==Module&&void 0!==render)this.wrapper=new ModuleWrapper(Module,render);else{if(void 0===Viz.Module||void 0===Viz.render)throw new Error("Must specify workerURL or worker option, Module and render options, or include one of full.render.js or lite.render.js after viz.js.");this.wrapper=new ModuleWrapper(Viz.Module,Viz.render)}}return createClass(Viz,[{key:"renderString",value:function(src){for(var _ref4=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},_ref4$format=_ref4.format,format=void 0===_ref4$format?"svg":_ref4$format,_ref4$engine=_ref4.engine,engine=void 0===_ref4$engine?"dot":_ref4$engine,_ref4$files=_ref4.files,files=void 0===_ref4$files?[]:_ref4$files,_ref4$images=_ref4.images,images=void 0===_ref4$images?[]:_ref4$images,_ref4$yInvert=_ref4.yInvert,yInvert=void 0!==_ref4$yInvert&&_ref4$yInvert,i=0;i<images.length;i++)files.push({path:images[i].path,data:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n<svg width="'+images[i].width+'" height="'+images[i].height+'"></svg>'});return this.wrapper.render(src,{format:format,engine:engine,files:files,images:images,yInvert:yInvert})}},{key:"renderSVGElement",value:function(src){var options=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.renderString(src,_extends({},options,{format:"svg"})).then(function(str){return(new DOMParser).parseFromString(str,"image/svg+xml").documentElement})}},{key:"renderImageElement",value:function(src){var options=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},scale=options.scale,mimeType=options.mimeType,quality=options.quality;return this.renderString(src,_extends({},options,{format:"svg"})).then(function(str){return"object"===("undefined"==typeof fabric?"undefined":_typeof(fabric))&&fabric.loadSVGFromString?svgXmlToImageElementFabric(str,{scale:scale,mimeType:mimeType,quality:quality}):svgXmlToImageElement(str,{scale:scale,mimeType:mimeType,quality:quality})})}},{key:"renderJSONObject",value:function(src){var options=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},format=options.format;return"json"===format&&"json0"===format||(format="json"),this.renderString(src,_extends({},options,{format:format})).then(function(str){return JSON.parse(str)})}}]),Viz}(),jssmViz_es5=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.vizjs=exports.png_el=exports.svg_el=exports.dot_to_svg=exports.dot=void 0,exports.vizjs=Viz;var default_viz_colors={graph_bg_color:"#eeeeee",fill_final:"#ddddff",fill_terminal:"#ffdddd",fill_complete:"#ddffdd",legal_1:"#888888",legal_2:"#777777",legal_solo:"#777777",legal_final_1:"#7777aa",legal_final_2:"#666699",legal_final_solo:"#666699",legal_terminal_1:"#aa7777",legal_terminal_2:"#996666",legal_terminal_solo:"#996666",legal_complete_1:"#77aa77",legal_complete_2:"#669966",legal_complete_solo:"#669966",main_1:"#444444",main_2:"#333333",main_solo:"#333333",main_final_1:"#333366",main_final_2:"#222255",main_final_solo:"#222255",main_terminal_1:"#663333",main_terminal_2:"#552222",main_terminal_solo:"#552222",main_complete_1:"#336633",main_complete_2:"#225522",main_complete_solo:"#225522",forced_1:"#cccccc",forced_2:"#bbbbbb",forced_solo:"#bbbbbb",forced_final_1:"#bbbbee",forced_final_2:"#aaaadd",forced_final_solo:"#aaaadd",forced_terminal_1:"#eebbbb",forced_terminal_2:"#ddaaaa",forced_terminal_solo:"#ddaaaa",forced_complete_1:"#bbeebb",forced_complete_2:"#aaddaa",forced_complete_solo:"#aaddaa",text_final_1:"#000088",text_final_2:"#000088",text_final_solo:"#000088",text_terminal_1:"#880000",text_terminal_2:"#880000",text_terminal_solo:"#880000",text_complete_1:"#007700",text_complete_2:"#007700",text_complete_solo:"#007700"},dot_to_svg=function(dot,config){return Viz(dot,config)};exports.dot_to_svg=dot_to_svg;exports.svg_el=function(dot,config){return(new DOMParser).parseFromString(dot_to_svg(dot,config),"text/html")};exports.png_el=function(dot,config){var cfg=Object.assign({},config,{format:"png-image-element"});return Viz(dot,cfg)};exports.dot=function(jssm){var l_states=jssm.states(),node_of=function(state){return"n".concat(l_states.indexOf(state))},vc=function(col){return default_viz_colors[col]||""},nodes=l_states.map(function(s){jssm.state_for(s);var terminal=jssm.state_is_terminal(s),final=jssm.state_is_final(s),complete=jssm.state_is_complete(s),features=[["label",s],["peripheries",complete?2:1],["fillcolor",final?vc("fill_final"):complete?vc("fill_complete"):terminal?vc("fill_terminal"):""]].filter(function(r){return r[1]}).map(function(r){return"".concat(r[0],'="').concat(r[1],'"')}).join(" ");return"".concat(node_of(s)," [").concat(features,"];")}).join(" "),strike=[],edges=jssm.states().map(function(s){return jssm.list_exits(s).map(function(ex){if(strike.find(function(row){return row[0]===s&&row[1]==ex}))return"";var doublequote=function(txt){return txt.replace('"','\\"')},edge=jssm.list_transitions(s,ex),edge_tr=(jssm.get_transition_by_state_names(s,ex),jssm.lookup_transition_for(s,ex)),pair=jssm.list_transitions(ex,s),pair_id=jssm.get_transition_by_state_names(ex,s),pair_tr=jssm.lookup_transition_for(ex,s),double=pair_id&&s!==ex,if_obj_field=(jssm.state_for(s),jssm.state_for(ex),function(obj,field){return obj&&obj[field]||""}),h_final=jssm.state_is_final(s),h_complete=jssm.state_is_complete(s),h_terminal=jssm.state_is_terminal(s),t_final=jssm.state_is_final(ex),t_complete=jssm.state_is_complete(ex),t_terminal=jssm.state_is_terminal(ex),lineColor=function(final,complete,terminal,lkind){var _solo_1_2=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"_solo";return vc(final?"".concat(lkind,"_final")+_solo_1_2:complete?"".concat(lkind,"_complete")+_solo_1_2:terminal?"".concat(lkind,"_terminal")+_solo_1_2:"".concat(lkind)+_solo_1_2)},textColor=function(final,complete,terminal){var _solo_1_2=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"_solo";return final?vc("text_final"+_solo_1_2):complete?vc("text_complete"+_solo_1_2):terminal?vc("text_terminal"+_solo_1_2):""},labelInline=[[pair,"probability","headlabel","name","action",double,textColor(h_final,h_complete,h_terminal,double?"_1":"_solo")],[edge,"probability","taillabel","name","action",!0,textColor(t_final,t_complete,t_terminal,double?"_2":"_solo")]].map(function(r){return{which:r[2],whether:r[5]&&[if_obj_field(r[0],r[5]),if_obj_field(r[0],r[1]),if_obj_field(r[0],r[3])].filter(function(q){return q}).join("<br/>")||"",color:r[6]}}).filter(function(present){return present.whether}).map(function(r){return"".concat(r.which,"=").concat(r.color?'<<font color="'.concat(r.color,'">').concat(r.whether,"</font>>"):'"'.concat(r.whether,'"'),";")}).join(" "),label=edge_tr&&["".concat(edge_tr.action||""),"".concat(edge_tr.probability||"")].filter(function(not_empty){return""!==not_empty}).join("\n")||void 0,maybeLabel=label?'taillabel="'.concat(doublequote(label),'";'):"",rlabel=pair_tr&&["".concat(pair_tr.action||""),"".concat(pair_tr.probability||"")].filter(function(not_empty){return""!==not_empty}).join("\n")||void 0,maybeRLabel=rlabel?'headlabel="'.concat(doublequote(rlabel),'";'):"",tc1=lineColor(t_final,t_complete,t_terminal,edge_tr.kind,"_1"),tc2=lineColor(h_final,h_complete,h_terminal,(pair_tr||{}).kind,"_2"),tcd=lineColor(t_final,t_complete,t_terminal,edge_tr.kind,"_solo"),arrowHead=edge_tr.forced_only?"ediamond":edge_tr.main_path?"normal;weight=5":"empty",arrowTail=pair_tr?pair_tr.forced_only?"ediamond":pair_tr.main_path?"normal;weight=5":"empty":"",edgeInline=edge?double?"".concat(maybeLabel).concat(maybeRLabel,"arrowhead=").concat(arrowHead,";arrowtail=").concat(arrowTail,';dir=both;color="').concat(tc1,":").concat(tc2,'"'):"".concat(maybeLabel,"arrowhead=").concat(arrowHead,';color="').concat(tcd,'"'):"";return pair&&strike.push([ex,s]),"".concat(node_of(s),"->").concat(node_of(ex)," [").concat(labelInline).concat(edgeInline,"];")}).join(" ")}).join(" "),MaybeRankDir=window&&window.lrGViz?"rankdir=LR;":"";return"digraph G {\n".concat(MaybeRankDir,'  fontname="Open Sans";\n  style=filled;\n  bgcolor="').concat(vc("graph_bg_color"),'";\n  node [fontsize=14; shape=box; style=filled; fillcolor=white; fontname="Times New Roman"];\n  edge [fontsize=6;fontname="Open Sans"];\n\n  ').concat(nodes,"\n\n  ").concat(edges,"\n}")}}),jssmViz_es5$1=unwrapExports(jssmViz_es5),jssmViz_es5_1=jssmViz_es5.vizjs,jssmViz_es5_2=jssmViz_es5.png_el,jssmViz_es5_3=jssmViz_es5.svg_el,jssmViz_es5_4=jssmViz_es5.dot_to_svg,jssmViz_es5_5=jssmViz_es5.dot;exports.default=jssmViz_es5$1,exports.vizjs=jssmViz_es5_1,exports.png_el=jssmViz_es5_2,exports.svg_el=jssmViz_es5_3,exports.dot_to_svg=jssmViz_es5_4,exports.dot=jssmViz_es5_5;